/*! For license information please see ms-source-link-app-dist.js.LICENSE.txt */
!function(){const e="https://asia-east2-ms-source-tracking-tool-dev.cloudfunctions.net/sourceTrackingToolDevUpdateFirestore",t="__ms_source_info",n=location.hostname.replace("www.",""),r=["utm_campaign","utm_source","utm_medium","utm_term","utm_content","utm_id","utm_source_platform","utm_creative_format","utm_marketing_tactic","fbclid","gclid","wbraid","dclid","msclkid","li_fat_id","ttclid","twclid"],o=e=>{const t=document.cookie.split(";");for(let n=0;n<t.length;n++){const r=t[n].trim();if(0===r.indexOf(e+"="))return r.substring(e.length+1)}return null},a=(e,t,n)=>{const r=new XMLHttpRequest;r.open("POST",e,!0),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.onreadystatechange=()=>{if(4===r.readyState&&200===r.status){const e=JSON.parse(r.responseText);n(e)}},r.send(JSON.stringify(t))},c=(e,t,n)=>{let r=location.hostname;r.split(".").length>2&&(r="."+r);const o=`${e}=${encodeURIComponent(t)}; expires=${n}; path=/; domain=${r};`;document.cookie=o},i=()=>{const e=new URLSearchParams(location.search),t={};return r.forEach((n=>{e.has(n)&&(t[n]=e.get(n))})),t},s=(t,n)=>{const r=e;n.uid=t,a(r,n,(()=>{}))},d=(e,n)=>{try{let r=o(t);r=decodeURIComponent(r);const a=r?JSON.parse(r):{};a.uid=e,a.created_at=n,c(t,JSON.stringify(a),new Date(Date.now()+63072e6))}catch(e){}},m=e=>{const n=new Date(Date.now()+63072e6),r={referrer:e};c(t,JSON.stringify(r),n);const o=i();(e=>{a("https://asia-east2-ms-source-tracking-tool-dev.cloudfunctions.net/sourceTrackingToolDevWriteFirestore",e,(e=>{e&&e.documentId&&e.createdTime&&d(e.documentId,e.createdTime)}))})({domain:location.hostname.replace("www.",""),source_data:[{created_at:Date.now(),domain:location.hostname.replace("www.",""),referrer:e,landing_page:location.pathname,query_params:o}]})},u=e=>{const r=o(t),a=JSON.parse(decodeURIComponent(r)).referrer;!e||e===n&&"direct"===e||(e=>{const t=document.location.hostname.replace("www.","");return e.includes(t)})(e)||((e,r)=>{r.referrer=e,c(t,JSON.stringify(r),new Date(Date.now()+63072e6));const o=(e=>{const t=e.split("|");return t[t.length-1]})(r.referrer),a=i(),d=r.uid,m={created_at:Date.now(),domain:n,referrer:o,landing_page:location.pathname,query_params:a};s(d,m)})(a+"|"+e,{referrer:a,uid:JSON.parse(decodeURIComponent(r)).uid})},l=t=>{a(e,t,(()=>{}))};(()=>{const e=o(t),r=document.referrer?new URL(document.referrer).hostname.replace("www.",""):"";e?u(r):(e=>{m(e&&e!==n?e:"direct")})(r)})(),document.querySelectorAll('input[type="email"], input[name^="email"], input[name*="mail"]').forEach((e=>{e.addEventListener("blur",(()=>{const n=e.value.trim();if(n){const e=o(t);if(e)try{const t=JSON.parse(decodeURIComponent(e)).uid;t&&l({uid:t,email:n})}catch(e){}}}))}))}();