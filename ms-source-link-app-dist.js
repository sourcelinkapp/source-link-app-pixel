/*! For license information please see ms-source-link-app-dist.js.LICENSE.txt */
!function(){const e="https://asia-east2-ms-source-tracking-tool-dev.cloudfunctions.net/sourceTrackingToolDevUpdateFirestore",t="__ms_source_info",r=location.hostname.replace("www.",""),n=document.currentScript.getAttribute("data-client-id");if(!n)return;const o=n.toUpperCase(),a=["utm_campaign","utm_source","utm_medium","utm_term","utm_content","utm_id","utm_source_platform","utm_creative_format","utm_marketing_tactic","fbclid","gclid","wbraid","dclid","msclkid","li_fat_id","ttclid","twclid"],c=e=>{const t=document.cookie.split(";");for(let r=0;r<t.length;r++){const n=t[r].trim();if(0===n.indexOf(e+"="))return n.substring(e.length+1)}return null},i=(e,t,r)=>{const n=new XMLHttpRequest;n.open("POST",e,!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.onreadystatechange=()=>{if(4===n.readyState&&200===n.status){const e=JSON.parse(n.responseText);r(e)}},n.send(JSON.stringify(t))},s=(e,t,r)=>{let n=location.hostname;n.split(".").length>2&&(n="."+n);const o=`${e}=${encodeURIComponent(t)}; expires=${r}; path=/; domain=${n};`;document.cookie=o},d=()=>{const e=new URLSearchParams(location.search),t={};return a.forEach((r=>{e.has(r)&&(t[r]=e.get(r))})),t},u=e=>{const n="v_"+Date.now()+"_"+Math.random().toString(36).slice(2,11),a={clientId:o,websiteId:r,visitorId:n,createdAt:Date.now(),sourceData:e.sourceData};i("https://asia-east2-ms-source-tracking-tool-dev.cloudfunctions.net/sourceTrackingToolDevWriteFirestore",a,(r=>{if(r&&r.success){const r={clientId:o,visitorId:n,referrer:e.sourceData[0].referrer,createdAt:Date.now()};s(t,JSON.stringify(r),new Date(Date.now()+63072e6))}}))},l=n=>{const a=c(t),u=JSON.parse(decodeURIComponent(a)),l=u.referrer,m=u.visitorId;if(n&&(n!==r||"direct"!==n)&&!(e=>{const t=document.location.hostname.replace("www.","");return e.includes(t)})(n)){u.referrer=l+"|"+n,s(t,JSON.stringify(u),new Date(Date.now()+63072e6));const a=(e=>{const t=e.split("|");return t[t.length-1]})(u.referrer),c=d();((t,n)=>{const a={clientId:o,websiteId:r,visitorId:t,updatedAt:Date.now(),sourceData:[n]};i(e,a,(()=>{}))})(m,{createdAt:Date.now(),referrer:a,landingPage:location.pathname,queryParams:c})}},m=e=>{(e=>{const t=d(),r={sourceData:[{createdAt:Date.now(),referrer:e,landingPage:location.pathname,queryParams:t}]};u(r)})(e&&e!==r?e:"direct")},p=t=>{i(e,t,(()=>{}))};(()=>{const e=c(t),r=document.referrer?new URL(document.referrer).hostname.replace("www.",""):"";e?l(r):m(r)})(),document.querySelectorAll('input[type="email"], input[name^="email"], input[name*="mail"]').forEach((e=>{e.addEventListener("blur",(()=>{const n=e.value.trim();if(n){const e=c(t);if(e)try{const t=JSON.parse(decodeURIComponent(e)).visitorId;t&&p({clientId:o,websiteId:r,visitorId:t,email:n})}catch(e){}}}))}))}();