/*! For license information please see sourcelink.js.LICENSE.txt */
!function(){const t="validate",e="create_visitor",r="update_source",n="update_email",a="https://us-west1-ms-source-tracking-tool-dev.cloudfunctions.net/sourceLinkWriteFirebase",o="_source_link_data",c=location.hostname.replace("www.","").toLocaleLowerCase(),i=["utm_campaign","utm_source","utm_medium","utm_term","utm_content","utm_id","utm_source_platform","utm_creative_format","utm_marketing_tactic","fbclid","gclid","wbraid","dclid","msclkid","li_fat_id","ttclid","twclid"],s=document.currentScript.getAttribute("data-client-id");if(!s)return;const d=s.toUpperCase(),u=`_source_link_${d}`,l=t=>{const e=document.cookie.split(";");for(let r=0;r<e.length;r++){const n=e[r].trim();if(0===n.indexOf(t+"="))return n.substring(t.length+1)}return null},m=(t,e,r)=>{let n=location.hostname;n.split(".").length>2&&(n="."+n);const a=`${t}=${encodeURIComponent(e)}; expires=${r}; path=/; domain=${n};`;document.cookie=a},w=async(t,e)=>{try{const r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify(e)});if(!r.ok)throw r.status,new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(t){throw t}},f=()=>{const t=new URLSearchParams(location.search),e={};return i.forEach((r=>{t.has(r)&&(e[r]=t.get(r))})),e},h=async t=>{const r="v_"+Date.now()+"_"+Math.random().toString(36).slice(2,11),n={action:e,clientId:d,websiteId:c,visitorId:r,createdAt:Date.now(),sourceData:t.sourceData};try{if((await w(a,n)).success){const e={clientId:d,websiteId:c,visitorId:r,referrer:t.sourceData[0].referrer,createdAt:Date.now()};m(o,JSON.stringify(e),new Date(Date.now()+63072e6))}}catch(t){}},p=t=>{(t=>{const e=f(),r={sourceData:[{createdAt:Date.now(),referrer:t,landingPage:location.pathname,queryParams:e}]};h(r)})(t&&t!==c?t:"direct")},_=t=>{const e=l(o),n=JSON.parse(decodeURIComponent(e)),i=n.referrer,s=n.visitorId;if(t&&(t!==c||"direct"!==t)&&!(t=>{const e=document.location.hostname.replace("www.","");return t.includes(e)})(t)){n.referrer=i+"|"+t,m(o,JSON.stringify(n),new Date(Date.now()+63072e6));const e=(t=>{const e=t.split("|");return e[e.length-1]})(n.referrer),u=f();(async(t,e)=>{const n={action:r,clientId:d,websiteId:c,visitorId:t,sourceData:[e]};try{await w(a,n)}catch(t){}})(s,{createdAt:Date.now(),referrer:e,landingPage:location.pathname,queryParams:u})}};(async()=>{await(async()=>{const e=sessionStorage.getItem(u);if(null!==e)return"true"===e;const r={action:t,clientId:d,websiteId:c,visitorId:"validation_check"};try{const t=await w(a,r),e=t.success&&t.isActive;return sessionStorage.setItem(u,e.toString()),e}catch(t){return!1}})()&&((()=>{const t=l(o),e=document.referrer?new URL(document.referrer).hostname.replace("www.",""):"";t?_(e):p(e)})(),document.querySelectorAll('input[type="email"], input[name^="email"], input[name*="mail"]').forEach((t=>{t.addEventListener("blur",(async()=>{const e=t.value.trim();if(e){const t=l(o);if(t)try{const r=JSON.parse(decodeURIComponent(t)).visitorId;if(r){const t={action:n,clientId:d,websiteId:c,visitorId:r,email:e};await w(a,t)}}catch(t){}}}))})))})()}();