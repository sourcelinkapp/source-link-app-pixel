/*! For license information please see sourcelink.js.LICENSE.txt */
!function(){const t="validate",e="create_visitor",r="update_source",a="update_email",n="https://us-west1-ms-source-tracking-tool-dev.cloudfunctions.net/sourceLinkWriteFirebase",o="_source_link_data",c=location.hostname.replace("www.","").toLocaleLowerCase(),i=["utm_campaign","utm_source","utm_medium","utm_term","utm_content","utm_id","utm_source_platform","utm_creative_format","utm_marketing_tactic","fbclid","gclid","wbraid","dclid","msclkid","li_fat_id","ttclid","twclid"],s=(t=>{const e=t.split("?")[1];return e?new URLSearchParams(e).get("pixelId"):null})(document.currentScript.src);if(!s)return;const u=s.toUpperCase(),d=`_source_link_${u}_PIXEL_VERSION_1.4.5`,l=t=>{const e=document.cookie.split(";");for(let r=0;r<e.length;r++){const a=e[r].trim();if(0===a.indexOf(t+"="))return a.substring(t.length+1)}return null},m=(t,e,r)=>{let a=location.hostname;a.split(".").length>2&&(a="."+a);const n=`${t}=${encodeURIComponent(e)}; expires=${r}; path=/; domain=${a};`;document.cookie=n},w=async(t,e)=>{try{const r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify(e)});if(!r.ok)throw r.status,new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(t){throw t}},p=()=>{const t=new URLSearchParams(location.search),e={};return i.forEach((r=>{t.has(r)&&(e[r]=t.get(r))})),e},f=async t=>{const r="v_"+Date.now()+"_"+Math.random().toString(36).slice(2,11),a={action:e,pixelId:u,websiteId:c,visitorId:r,createdAt:Date.now(),sourceData:t.sourceData};try{if((await w(n,a)).success){const e={pixelId:u,websiteId:c,visitorId:r,referrer:t.sourceData[0].referrer,createdAt:Date.now()};m(o,JSON.stringify(e),new Date(Date.now()+63072e6))}}catch(t){}},h=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),_=t=>{(t=>{const e=p(),r={sourceData:[{createdAt:Date.now(),referrer:t,landingPage:location.pathname,queryParams:e}]};f(r)})(t&&t!==c?t:"direct")},I=t=>{const e=l(o),a=JSON.parse(decodeURIComponent(e)),i=a.referrer,s=a.visitorId;if(t&&(t!==c||"direct"!==t)&&!(t=>{const e=document.location.hostname.replace("www.","");return t.includes(e)})(t)){a.referrer=i+"|"+t,m(o,JSON.stringify(a),new Date(Date.now()+63072e6));const e=(t=>{const e=t.split("|");return e[e.length-1]})(a.referrer),d=p();(async(t,e)=>{const a={action:r,pixelId:u,websiteId:c,visitorId:t,sourceData:[e]};try{await w(n,a)}catch(t){}})(s,{createdAt:Date.now(),referrer:e,landingPage:location.pathname,queryParams:d})}};(async()=>{await(async()=>{const e=sessionStorage.getItem(d);if(null!==e)return"true"===e;const r={action:t,pixelId:u,websiteId:c,visitorId:"validation_check"};try{const t=await w(n,r),e=t.success&&t.isActive;return sessionStorage.setItem(d,e.toString()),e}catch(t){return!1}})()&&((()=>{const t=l(o),e=document.referrer?new URL(document.referrer).hostname.replace("www.",""):"";t?I(e):_(e)})(),document.querySelectorAll('input[type="email"], input[name^="email"], input[name*="mail"]').forEach((t=>{t.addEventListener("blur",(async()=>{const e=t.value.trim();if(e&&h(e)){const t=l(o);if(t)try{const r=JSON.parse(decodeURIComponent(t)).visitorId;if(r){const t={action:a,pixelId:u,websiteId:c,visitorId:r,email:e};await w(n,t)}}catch(t){}}else e&&h(e)}))})))})()}();