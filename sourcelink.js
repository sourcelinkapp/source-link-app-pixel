/*! For license information please see sourcelink.js.LICENSE.txt */
!function(){const t="https://asia-east2-ms-source-tracking-tool-dev.cloudfunctions.net/sourceTrackingToolDevWriteFirestore",e="_source_link_data",r=location.hostname.replace("www.","").toLocaleLowerCase(),n=document.currentScript.getAttribute("data-client-id");if(!n)return;const a=n.toUpperCase(),o=`_source_link_${a}`,c=["utm_campaign","utm_source","utm_medium","utm_term","utm_content","utm_id","utm_source_platform","utm_creative_format","utm_marketing_tactic","fbclid","gclid","wbraid","dclid","msclkid","li_fat_id","ttclid","twclid"],i=t=>{const e=document.cookie.split(";");for(let r=0;r<e.length;r++){const n=e[r].trim();if(0===n.indexOf(t+"="))return n.substring(t.length+1)}return null},s=async(t,e)=>{try{const r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify(e)});if(!r.ok)throw r.status,new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(t){throw t}},d=(t,e,r)=>{let n=location.hostname;n.split(".").length>2&&(n="."+n);const a=`${t}=${encodeURIComponent(e)}; expires=${r}; path=/; domain=${n};`;document.cookie=a},u=()=>{const t=new URLSearchParams(location.search),e={};return c.forEach((r=>{t.has(r)&&(e[r]=t.get(r))})),e},l=async n=>{const o="v_"+Date.now()+"_"+Math.random().toString(36).slice(2,11),c={clientId:a,websiteId:r,visitorId:o,createdAt:Date.now(),sourceData:n.sourceData};try{if((await s(t,c)).success){const t={clientId:a,websiteId:r,visitorId:o,referrer:n.sourceData[0].referrer,createdAt:Date.now()};d(e,JSON.stringify(t),new Date(Date.now()+63072e6))}}catch(t){}},m=n=>{const o=i(e),c=JSON.parse(decodeURIComponent(o)),l=c.referrer,m=c.visitorId;if(n&&(n!==r||"direct"!==n)&&!(t=>{const e=document.location.hostname.replace("www.","");return t.includes(e)})(n)){c.referrer=l+"|"+n,d(e,JSON.stringify(c),new Date(Date.now()+63072e6));const o=(t=>{const e=t.split("|");return e[e.length-1]})(c.referrer),i=u();(async(e,n)=>{const o={clientId:a,websiteId:r,visitorId:e,sourceData:[n]};try{await s(t,o)}catch(t){}})(m,{createdAt:Date.now(),referrer:o,landingPage:location.pathname,queryParams:i})}},w=t=>{(t=>{const e=u(),r={sourceData:[{createdAt:Date.now(),referrer:t,landingPage:location.pathname,queryParams:e}]};l(r)})(t&&t!==r?t:"direct")};(async()=>{await(async()=>{const e=sessionStorage.getItem(o);if(null!==e)return"true"===e;const n={clientId:a,action:"validate",websiteId:r,visitorId:"validation_check"};try{const e=await s(t,n),r=e.success&&e.isActive;return sessionStorage.setItem(o,r.toString()),r}catch(t){return!1}})()&&((()=>{const t=i(e),r=document.referrer?new URL(document.referrer).hostname.replace("www.",""):"";t?m(r):w(r)})(),document.querySelectorAll('input[type="email"], input[name^="email"], input[name*="mail"]').forEach((n=>{n.addEventListener("blur",(async()=>{const o=n.value.trim();if(o){const n=i(e);if(n)try{const e=JSON.parse(decodeURIComponent(n)).visitorId;if(e){const n={clientId:a,websiteId:r,visitorId:e,email:o};await s(t,n)}}catch(t){}}}))})))})()}();